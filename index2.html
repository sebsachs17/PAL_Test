<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PAL – Online-Test mit SI/TI (Schwierigkeitsindex & Trennschärfe)</title>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; max-width: 960px; margin: 40px auto; padding: 0 16px; }
    h1 { margin-bottom: 0.35rem; }
    .meta { color: #555; margin-bottom: 0.5rem; }
    .legend { background:#f7f7f7; border:1px solid #e5e5e5; padding:10px 12px; border-radius:8px; margin-bottom: 14px; }
    .actions { display:flex; gap: 12px; margin: 12px 0 16px; flex-wrap: wrap; align-items:center; }
    .card { border: 1px solid #e5e5e5; border-radius: 10px; padding: 16px; margin: 16px 0; }
    .choices label { display:block; margin: 6px 0; cursor: pointer; }
    button { padding: 10px 16px; border-radius: 8px; border: 1px solid #cfcfcf; cursor: pointer; }
    .result { font-weight: 700; padding: 12px; border-radius: 10px; margin-top: 12px; }
    .pass { background: #e7f7ee; border: 1px solid #a6e0c3; color: #0f5c3a; }
    .fail { background: #fdecec; border: 1px solid #f3b7b7; color: #8a1c1c; }
    .muted { color:#666; font-size: 0.95rem; white-space: pre-wrap; }
    .hidden { display:none; }
    .footer { margin-top: 28px; font-size: 0.9rem; color:#666;}
    .pill { font-size:0.8rem; color:#333; background:#eef5ff; border:1px solid #cfe2ff; border-radius:999px; padding:2px 8px; margin-left:8px; }
    .pill.bad { background:#fff0f0; border-color:#f1c0c0; }
    .right { margin-left:auto; }
    .timer { font-weight: 800; padding: 6px 10px; border-radius: 8px; border: 1px solid #e5e5e5; }
    .timer.warning { color: #8a1c1c; border-color: #f3b7b7; background: #fdecec; }
  </style>
</head>
<body>
  <h1>PAL – Standardisierter Online-Test</h1>
  <div class="meta" id="meta"></div>
  <div class="legend">
    <strong>Hinweis zu SI/TI (für Ersteller:innen):</strong>
    <div>SI = <em>Schwierigkeitsindex</em> (p-Wert, Anteil korrekter Antworten: 0 = sehr schwer, 1 = sehr leicht). Zielbereich je nach Einsatz: ca. 0.3–0.8.</div>
    <div>TI = <em>Trennschärfe</em> (≈ Punkt-Biserial-Korrelation; −1 bis +1). Ziel: möglichst &gt; 0.2, gut ab ≈ 0.3–0.4.</div>
  </div>

  <div class="actions">
    <div id="timer" class="timer" aria-live="polite" title="Countdown"></div>
    <button id="submitBtn">Abgeben & Ergebnis anzeigen</button>
    <button id="retryBtn" class="hidden">Neu starten</button>
    <label class="right"><input type="checkbox" id="togglePsych"> SI/TI anzeigen (nur Ersteller)</label>
  </div>

  <div id="summary" class="result hidden"></div>
  <p id="psychStats" class="muted hidden"></p>

  <div id="quiz"></div>

  <div class="footer">
    <p class="muted">Reihenfolge der Antworten ist zufällig. Verarbeitung erfolgt lokal im Browser.</p>
  </div>

<script>
/* ======= KONFIGURATION ======= */
const TEST_TITLE = "Prüfen, Prüfungsangst & Bezugsnormen – 15 Single-Choice-Fragen";
const TEST_DESC  = "Zeitempfehlung: 5–10 Min";
const PASS_THRESHOLD = 60; // % für "Bestanden"
const TIME_LIMIT_SECS = 5 * 60; // 5 Minuten Timer (ändern auf z.B. 8*60)

/* ======= FRAGENBANK (SI/TI enthalten) =======
  Themen: Prüfen (OSCE/Objektivität/Reliabilität/Validität), Prüfungsangst (Interventionen/Attribution),
          Bezugsnormen (kriterial/sozial/individual).
  Felder je Item: q, choices[], correctIndex, feedback, si (0..1), ti (-1..+1)
*/
const ITEM_BANK = [
  { q: "Welche erste Formulierung eröffnet ein konstruktives Prüfungs-Feedbackgespräch am besten, wenn ein Prüfling verunsichert ist?",
    choices: [
      "„Warum haben Sie das schon wieder falsch gemacht?“",
      "„Beschreiben Sie bitte kurz aus Ihrer Sicht den Ablauf – was lief gut, was möchten Sie verbessern?“",
      "„Das war insgesamt mangelhaft, wir müssen alles neu üben.“",
      "„Ich erkläre Ihnen jetzt, wie es richtig geht; Fragen später.“"
    ],
    correctIndex: 1, feedback: "Selbsteinschätzung zuerst; öffnet die Reflexion und entlastet.", si: 0.72, ti: 0.36
  },
  { q: "Welche Bezugsnorm orientiert die Bewertung an festgelegten Kriterien (z. B. Checkliste, Kompetenzstandard)?",
    choices: [
      "Sozialnorm (Vergleich mit der Gruppe)",
      "Kriterialnorm (Vergleich mit einem Standard)",
      "Individualnorm (Vergleich mit früherer eigener Leistung)",
      "Zufallsnorm (Vergleich mit dem Würfel)"
    ],
    correctIndex: 1, feedback: "Kriterialnorm = an Standards/Kriterien orientiert.", si: 0.66, ti: 0.34
  },
  { q: "Prüfungsangst reduzieren: Welche Maßnahme ist nachweislich hilfreich und fair?",
    choices: [
      "Spontanfragen ohne Kriterien – so sieht man, wer spontan ist",
      "Transparente Bewertungskriterien und Beispielaufgaben vorab bereitstellen",
      "Unterschiedliche Aufgaben je Prüfling ohne Abgleich",
      "Zeitlimit stark verkürzen – dann entscheidet Instinkt"
    ],
    correctIndex: 1, feedback: "Transparenz zu Aufgaben & Kriterien senkt Unsicherheit und erhöht Fairness.", si: 0.68, ti: 0.33
  },
  { q: "Kurzintervention bei Prüfungsangst direkt vor der Prüfung (5–10 Min) – was ist am zielführendsten?",
    choices: [
      "Atemfokus + knappe positive Selbstinstruktion",
      "Alle Leitlinien im Schnelldurchlauf wiederholen",
      "Ignorieren der Symptome",
      "Beruhigungsmittel ohne Indikation"
    ],
    correctIndex: 0, feedback: "Atemfokus/Selbstinstruktion senkt Erregung, stabilisiert Leistung.", si: 0.58, ti: 0.34
  },
  { q: "Nach einem Fehlschlag sagt der Prüfling: „Ich bin einfach zu dumm für Prüfungen.“ Welche Rückmeldung hilft am ehesten heraus?",
    choices: [
      "„Manche können das nie.“",
      "„Das war nur Pech.“",
      "„Du kannst es lernen: Wir üben gezielt; dein Einsatz und Strategie machen den Unterschied.“",
      "„Mach dir keine Gedanken, das wird schon irgendwie.“"
    ],
    correctIndex: 2, feedback: "Auf veränderbare Faktoren (Anstrengung/Strategie) lenken statt stabilem „Unvermögen“. ", si: 0.63, ti: 0.39
  },
  { q: "Ergebnisblatt: „78 % erreicht, ab 60 % gilt ‚bestanden‘.“ Welche Bezugsnorm liegt vor?",
    choices: [
      "Sozialnorm",
      "Kriterialnorm",
      "Individualnorm",
      "Keine Bezugsnorm"
    ],
    correctIndex: 1, feedback: "Vergleich mit einem festen Kriterium/Schwelle = Kriterialnorm.", si: 0.70, ti: 0.31
  },
  { q: "OSCE-Station „Stabile Seitenlage“ – welcher Prüfungsauftrag passt zum Anforderungsniveau „Anwenden“?",
    choices: [
      "Die Definition von Bewusstlosigkeit wiedergeben",
      "Die stabile Seitenlage in korrekter Reihenfolge durchführen",
      "Die historische Entwicklung erläutern",
      "Vor- und Nachteile verschiedener Lagerungen diskutieren"
    ],
    correctIndex: 1, feedback: "„Anwenden“ = prozedurale Durchführung.", si: 0.64, ti: 0.33
  },
  { q: "Feedback nach dem Sandwich-Prinzip – was kommt zuerst?",
    choices: [
      "Positiver/gelungener Aspekt",
      "Verbesserungspunkt",
      "Zusammenfassung/Abschluss",
      "Begründung, warum etwas schlecht war"
    ],
    correctIndex: 0, feedback: "Sandwich: Positives → Verbesserung → Abschluss.", si: 0.74, ti: 0.30
  },
  { q: "Während einer OSCE-Prüfung führt der Prüfling den Esmarch-Handgriff falsch aus. Was ist korrektes Vorgehen als Prüfer:in?",
    choices: [
      "Sofort detailliert anleiten und jeden Schritt vormachen",
      "Checkliste weiterführen; nur bei Patientengefährdung sicher abbrechen/eingreifen",
      "Fehler ignorieren und maximal abwerten",
      "Keine Rückmeldung, auch nicht nach der Prüfung"
    ],
    correctIndex: 1, feedback: "Prüfen statt Lehren: standardisiert bewerten; Sicherheit geht vor (Abbruch/Hinweis nur bei Gefahr).", si: 0.57, ti: 0.38
  },
  { q: "Prüfungsangst – welche Aussage trifft zu?",
    choices: [
      "Angst ist ausschließlich leistungshemmend",
      "Angst kann kognitive Ressourcen auch aktivieren",
      "Ignorieren lässt Angst am schnellsten verschwinden",
      "Angst zeigt fehlende Eignung"
    ],
    correctIndex: 1, feedback: "Angst kann auch aktivierend wirken; entscheidend ist die Regulation.", si: 0.62, ti: 0.26
  },
  { q: "SMARTes Prüfungsziel – welche Formulierung ist am ehesten SMART?",
    choices: [
      "Schüler soll besser verstehen",
      "Bis Freitag 3/3 i.v.-Zugänge am Skill-Trainer regelgerecht legen",
      "Schüler wird aufmerksamer sein",
      "Notfälle angemessen managen"
    ],
    correctIndex: 1, feedback: "Spezifisch, messbar, terminiert und überprüfbar.", si: 0.67, ti: 0.32
  },
  { q: "Für eine faire, vergleichbare Bewertung im OSCE sorgt am ehesten …",
    choices: [
      "Nur ein Freitext-Eindruck ohne Kriterien",
      "Eine standardisierte Checkliste mit verhaltensverankerten Skalen (BARS) und zwei Beurteilende",
      "Alleinurteil der erfahrensten Person",
      "Punkte nach Gefühl"
    ],
    correctIndex: 1, feedback: "Kriterien + Mehrfachbeurteilung erhöhen Objektivität/Reliabilität.", si: 0.57, ti: 0.41
  },
  { q: "Im Feedback sagst du: „Du hast dich seit der letzten Prüfung um zwei Notenstufen verbessert.“ Welche Bezugsnorm nutzt du?",
    choices: [
      "Sozialnorm",
      "Kriterialnorm",
      "Individualnorm",
      "Keine Bezugsnorm"
    ],
    correctIndex: 2, feedback: "Vergleich mit eigener früherer Leistung = Individualnorm.", si: 0.65, ti: 0.35
  },
  { q: "Debriefing nach Simulation – worum geht es in erster Linie?",
    choices: [
      "Nur eine Fehlerliste erstellen",
      "Die Note mitteilen",
      "Gemeinsam lernen: Eindrücke kurz benennen, Leistung analysieren, klare Take-aways festhalten",
      "Die Übung Wort für Wort nacherzählen"
    ],
    correctIndex: 2, feedback: "Ziel: Reflexion + Analyse + Lernpunkte, nicht bloß Bewertung.", si: 0.60, ti: 0.36
  },
  { q: "Gütekriterien: Was beschreibt „Objektivität“ am besten?",
    choices: [
      "Die Prüfung misst, was sie messen soll",
      "Die Ergebnisse sind unabhängig von der bewertenden Person",
      "Die Ergebnisse sind bei Wiederholung stabil",
      "Die Prüfung ist möglichst schwer"
    ],
    correctIndex: 1, feedback: "Objektivität = Unabhängigkeit vom Beurteilenden; Validität = misst das Richtige; Reliabilität = Zuverlässigkeit.", si: 0.54, ti: 0.40
  }
];

/* ======= LOGIK ======= */
function shuffle(arr){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

function renderQuiz(items, showPsych=false){
  const container = document.getElementById("quiz");
  container.innerHTML = "";
  items.forEach((item, idx) => {
    const card = document.createElement("div");
    card.className = "card";

    const h3 = document.createElement("h3");
    h3.textContent = `Frage ${idx + 1}`;

    // SI/TI Pills (designer only)
    const pillSI = document.createElement("span");
    pillSI.className = "pill" + ((item.si<0.3 || item.si>0.85) ? " bad" : "");
    pillSI.textContent = `SI: ${item.si.toFixed(2)}`;

    const pillTI = document.createElement("span");
    pillTI.className = "pill" + ((item.ti<0.2) ? " bad" : "");
    pillTI.textContent = `TI: ${item.ti.toFixed(2)}`;

    if(showPsych){
      h3.appendChild(pillSI);
      h3.appendChild(pillTI);
    }
    card.appendChild(h3);

    const p = document.createElement("p");
    p.textContent = item.q;
    card.appendChild(p);

    const choiceOrder = shuffle(item.choices.map((c,i)=>({c,i})));
    const div = document.createElement("div");
    div.className = "choices";

    choiceOrder.forEach(({c,i})=>{
      const id = `q${idx}_opt${i}`;
      const label = document.createElement("label");
      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q${idx}`;
      input.value = i;
      input.id = id;
      label.setAttribute("for", id);
      label.appendChild(input);
      label.append(" " + c);
      div.appendChild(label);
    });

    card.appendChild(div);
    container.appendChild(card);
  });
}

function grade(items){
  let correct=0;
  const perQuestion=[];
  items.forEach((item, idx)=>{
    const selected = document.querySelector(`input[name="q${idx}"]:checked`);
    const selIndex = selected ? parseInt(selected.value,10) : null;
    const ok = selIndex === item.correctIndex;
    perQuestion.push({ ok, selIndex, correctIndex:item.correctIndex, feedback:item.feedback||"", si:item.si, ti:item.ti });
    if(ok) correct++;
  });
  const total = items.length;
  const percent = Math.round((correct/total)*100);
  const passed = percent >= PASS_THRESHOLD;
  return { correct, total, percent, passed, perQuestion };
}

function disableQuiz(){
  document.querySelectorAll('input[type="radio"]').forEach(inp => inp.disabled = true);
  document.getElementById("submitBtn").disabled = true;
}

/* ======= TIMER ======= */
let remaining = TIME_LIMIT_SECS;
let timerInt = null;
let submitted = false;
let timeUpTriggered = false;

function fmt(t){
  const m = Math.floor(t/60).toString().padStart(1,'0');
  const s = (t%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

function startTimer(){
  const el = document.getElementById("timer");
  el.textContent = `Zeit: ${fmt(remaining)}`;
  if(remaining <= 60) el.classList.add("warning");
  timerInt = setInterval(()=>{
    remaining--;
    el.textContent = `Zeit: ${fmt(remaining)}`;
    if(remaining <= 60) el.classList.add("warning");
    if(remaining <= 0){
      clearInterval(timerInt);
      if(!submitted){
        timeUpTriggered = true;
        document.getElementById("submitBtn").click();
      }
    }
  }, 1000);
}

/* ======= INIT ======= */
const randomizedItems = shuffle(ITEM_BANK.slice());
const meta = document.getElementById("meta");
meta.textContent = `${TEST_TITLE} · ${TEST_DESC} · Bestehensgrenze: ${PASS_THRESHOLD}% · Zeitlimit: ${Math.round(TIME_LIMIT_SECS/60)} Min`;
renderQuiz(randomizedItems, false);
startTimer();

/* ======= EVENTS ======= */
document.getElementById("submitBtn").addEventListener("click", ()=>{
  if(submitted) return;
  submitted = true;
  clearInterval(timerInt);
  const { correct, total, percent, passed, perQuestion } = grade(randomizedItems);
  const box = document.getElementById("summary");
  box.classList.remove("hidden","pass","fail");
  box.classList.add("result", passed ? "pass" : "fail");
  box.textContent = `${percent}% (${correct}/${total}) – ${passed ? "Bestanden ✅" : "Nicht bestanden ❌"}` + (timeUpTriggered ? " · Zeit abgelaufen ⏰ – automatische Abgabe" : "");

  // Psychometrie-Auswertung (nur für Ersteller – nicht antwortspezifisch)
  const avgSI = perQuestion.reduce((s,q)=>s+q.si,0)/perQuestion.length;
  const avgTI = perQuestion.reduce((s,q)=>s+q.ti,0)/perQuestion.length;
  const stats = document.getElementById("psychStats");
  stats.textContent = `Mittelwerte (Items): SI ≈ ${avgSI.toFixed(2)}, TI ≈ ${avgTI.toFixed(2)}. ` +
                      `Empfehlung: SI 0.3–0.8, TI ≥ 0.20 (je nach Einsatz).`;
  stats.classList.remove("hidden");

  disableQuiz();
  document.getElementById("retryBtn").classList.remove("hidden");
  window.scrollTo({ top: document.body.scrollHeight, behavior:"smooth" });
});

document.getElementById("retryBtn").addEventListener("click", ()=>location.reload());

document.getElementById("togglePsych").addEventListener("change", (e)=>{
  const show = e.target.checked;
  renderQuiz(randomizedItems, show);
});
</script>
</body>
</html>
