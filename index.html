<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PAL – Online-Test mit SI/TI (Schwierigkeitsindex & Trennschärfe)</title>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; max-width: 960px; margin: 40px auto; padding: 0 16px; }
    h1 { margin-bottom: 0.35rem; }
    .meta { color: #555; margin-bottom: 1rem; }
    .legend { background:#f7f7f7; border:1px solid #e5e5e5; padding:10px 12px; border-radius:8px; margin-bottom: 14px; }
    .card { border: 1px solid #e5e5e5; border-radius: 10px; padding: 16px; margin: 16px 0; }
    .choices label { display:block; margin: 6px 0; cursor: pointer; }
    button { padding: 10px 16px; border-radius: 8px; border: 1px solid #cfcfcf; cursor: pointer; }
    .actions { display:flex; gap: 12px; margin-top: 16px; flex-wrap: wrap; align-items:center; }
    .result { font-weight: 700; padding: 12px; border-radius: 10px; margin-top: 12px; }
    .pass { background: #e7f7ee; border: 1px solid #a6e0c3; color: #0f5c3a; }
    .fail { background: #fdecec; border: 1px solid #f3b7b7; color: #8a1c1c; }
    .muted { color:#666; font-size: 0.95rem; white-space: pre-wrap; }
    .hidden { display:none; }
    .footer { margin-top: 28px; font-size: 0.9rem; color:#666;}
    .pill { font-size:0.8rem; color:#333; background:#eef5ff; border:1px solid #cfe2ff; border-radius:999px; padding:2px 8px; margin-left:8px; }
    .pill.bad { background:#fff0f0; border-color:#f1c0c0; }
    .right { margin-left:auto; }
  </style>
</head>
<body>
  <h1>PAL – Standardisierter Online-Test</h1>
  <div class="meta" id="meta"></div>
  <div class="legend">
    <strong>Hinweis zu SI/TI (für Ersteller:innen):</strong>
    <div>SI = <em>Schwierigkeitsindex</em> (p-Wert, Anteil korrekter Antworten: 0 = sehr schwer, 1 = sehr leicht). Zielbereich je nach Einsatz: ca. 0.3–0.8.</div>
    <div>TI = <em>Trennschärfe</em> (≈ Punkt-Biserial-Korrelation; −1 bis +1). Ziel: möglichst &gt; 0.2, gut ab ≈ 0.3–0.4.</div>
  </div>

  <div class="actions">
    <button id="submitBtn">Abgeben & Ergebnis anzeigen</button>
    <button id="retryBtn" class="hidden">Neu starten</button>
    <label class="right"><input type="checkbox" id="togglePsych"> SI/TI anzeigen (nur Ersteller)</label>
  </div>

  <div id="summary" class="result hidden"></div>
  <p id="psychStats" class="muted hidden"></p>

  <div id="quiz"></div>

  <div class="footer">
    <p class="muted">Reihenfolge der Antworten ist zufällig. Verarbeitung erfolgt lokal im Browser.</p>
  </div>

<script>
/* ======= KONFIGURATION ======= */
const TEST_TITLE = "Praxisanleitung im Rettungsdienst – 15 Single-Choice-Fragen";
const TEST_DESC  = "Zeitempfehlung: 12–15 Min";
const PASS_THRESHOLD = 70; // % für "Bestanden"

/* ======= FRAGENBANK (SI/TI enthalten) =======
  Felder je Item:
  - q: Frage
  - choices: Antwortoptionen
  - correctIndex: Index der korrekten Option
  - feedback: kurze Erläuterung
  - si: Schwierigkeitsindex p (0..1)
  - ti: Trennschärfe (−1..+1; hier ca. 0..0.5 als typische Praxiswerte)
*/
const ITEM_BANK = [
  { q: "Welche erste Formulierung eröffnet ein konstruktives Feedbackgespräch am besten, wenn ein Schüler beim i.v.-Zugang verunsichert ist?",
    choices: [
      "„Warum haben Sie das schon wieder falsch gemacht?“",
      "„Beschreiben Sie bitte kurz aus Ihrer Sicht den Ablauf – was lief gut, was möchten Sie verbessern?“",
      "„Das war insgesamt mangelhaft, wir müssen alles neu üben.“",
      "„Ich erkläre Ihnen jetzt, wie es richtig geht; Fragen später.“"
    ],
    correctIndex: 1, feedback: "Selbsteinschätzung vor Fremdeinschätzung (Pendleton).", si: 0.72, ti: 0.36
  },
  { q: "Benner-Modell: Welche Reihenfolge ist korrekt?",
    choices: [
      "Novize → Fortgeschrittener Anfänger → Kompetent → Erfahren → Experte",
      "Novize → Kompetent → Fortgeschrittener Anfänger → Experte → Erfahren",
      "Fortgeschrittener Anfänger → Novize → Kompetent → Erfahren → Experte",
      "Novize → Erfahren → Fortgeschrittener Anfänger → Kompetent → Experte"
    ],
    correctIndex: 0, feedback: "Benners Stufenfolge.", si: 0.61, ti: 0.28
  },
  { q: "KMK-Kompetenzen: Welche Option gehört NICHT dazu?",
    choices: ["Fachkompetenz","Personale Kompetenz","Sozialkompetenz","Räumliche Kompetenz"],
    correctIndex: 3, feedback: "KMK: Fach-, Personal-, Sozial-, Methodenkompetenz.", si: 0.69, ti: 0.31
  },
  { q: "Kurzintervention bei Prüfungsangst im OSCE (10 Min) – was ist am zielführendsten?",
    choices: [
      "5-min Atemfokus + positive Selbstinstruktion",
      "10-min Theoriewiederholung aller Leitlinien",
      "Ignorieren der Symptome",
      "Medikamentengabe"
    ],
    correctIndex: 0, feedback: "Atemfokus/Selbstinstruktion senkt Erregung.", si: 0.58, ti: 0.34
  },
  { q: "Kausalattribuierung: Welche Attribution begünstigt erlernte Hilflosigkeit nach Misserfolg am ehesten?",
    choices: [
      "Extern, variabel, kontrollierbar",
      "Intern, stabil, nicht kontrollierbar",
      "Extern, stabil, kontrollierbar",
      "Intern, variabel, kontrollierbar"
    ],
    correctIndex: 1, feedback: "Intern-stabil-unkontrollierbar = Risiko für Hilflosigkeit.", si: 0.47, ti: 0.40
  },
  { q: "DSGVO im Praxissetting: Welche Aussage ist korrekt?",
    choices: [
      "Einwilligung ist die einzige Rechtsgrundlage.",
      "Anonymisierte Fallvignetten sind keine personenbezogenen Daten.",
      "Teamchats dürfen Patientendaten ungeschützt übertragen.",
      "Die DSGVO gilt nicht in der Ausbildung."
    ],
    correctIndex: 1, feedback: "Anonymisierte Daten sind nicht personenbezogen.", si: 0.66, ti: 0.27
  },
  { q: "Lernzielniveau ‚Anwenden‘ (Bloom): Welches Ziel passt am besten?",
    choices: [
      "Definition von Bewusstlosigkeit wiedergeben",
      "Stabile Seitenlage in korrekter Reihenfolge durchführen",
      "Historische Entwicklung erläutern",
      "Vor- und Nachteile verschiedener Lagerungen diskutieren"
    ],
    correctIndex: 1, feedback: "‚Anwenden‘ = prozedurale Durchführung.", si: 0.64, ti: 0.33
  },
  { q: "Pendleton-Feedback: Was kommt zuerst?",
    choices: [
      "Anleitende nennen Verbesserungen",
      "Lernende nennen, was gut lief",
      "Anleitende geben Urteil",
      "Lernende verteidigen sich"
    ],
    correctIndex: 1, feedback: "Start mit Stärken der Lernenden.", si: 0.73, ti: 0.29
  },
  { q: "Esmarch-Handgriff im Training: Was ist unmittelbar richtig?",
    choices: [
      "Fortsetzen lassen – aus Fehlern lernt man am meisten",
      "Kurz stoppen, Sicherheit herstellen, korrekt demonstrieren und sofort üben lassen",
      "Abbruch und Abmahnung",
      "Fehler ignorieren, erst am Ende besprechen"
    ],
    correctIndex: 1, feedback: "Sicherheit + Micro-Teaching.", si: 0.59, ti: 0.38
  },
  { q: "Prüfungsangst – welche Aussage trifft zu?",
    choices: [
      "Angst ist ausschließlich leistungshemmend",
      "Angst kann Gedächtnisprozesse auch aktivieren",
      "Ignorieren lässt Angst am schnellsten verschwinden",
      "Angst zeigt fehlende Eignung"
    ],
    correctIndex: 1, feedback: "Angst kann auch aktivierend wirken.", si: 0.62, ti: 0.26
  },
  { q: "SMARTes Lernziel – welche Formulierung ist am ehesten SMART?",
    choices: [
      "Schüler soll besser verstehen",
      "Bis Freitag 3/3 i.v.-Zugänge regelgerecht legen",
      "Schüler wird aufmerksamer sein",
      "Notfälle angemessen managen"
    ],
    correctIndex: 1, feedback: "Spezifisch, messbar, terminiert.", si: 0.67, ti: 0.32
  },
  { q: "Objektive Bewertung im OSCE – was reduziert Bias am ehesten?",
    choices: [
      "Freitext ohne Kriterien",
      "Checkliste mit BARS + zwei Beurteilende",
      "Alleinurteil des Erfahrensten",
      "Bauchgefühl"
    ],
    correctIndex: 1, feedback: "Kriterien + Mehrfachbeurteilung.", si: 0.55, ti: 0.41
  },
  { q: "Rolle der Praxisanleitung – welche Aussage ist NICHT korrekt?",
    choices: [
      "PAL planen, begleiten und evaluieren Lernprozesse",
      "PAL fördern Reflexion und strukturiertes Feedback",
      "PAL legen alleine die Abschlussnote fest",
      "PAL sichern Patientensicherheit während angeleiteter Maßnahmen"
    ],
    correctIndex: 2, feedback: "Notenvergabe ist abgestimmt mit Schule/Trägern.", si: 0.71, ti: 0.24
  },
  { q: "Debriefing nach Simulation – sinnvolle Reihenfolge?",
    choices: [
      "Analyse → Reaktion → Zusammenfassung",
      "Reaktion → Analyse → Zusammenfassung",
      "Zusammenfassung → Analyse → Reaktion",
      "Urteil → Analyse → Reaktion"
    ],
    correctIndex: 1, feedback: "Erst Reaktionen, dann Analyse, dann Take-aways.", si: 0.52, ti: 0.37
  },
  { q: "Lehr-Fallvignetten & Datenschutz – was ist richtig?",
    choices: [
      "Kombination seltener Merkmale ist unkritisch",
      "Vignetten so verändern, dass Re-Identifikation praktisch ausgeschlossen ist",
      "Teilgesicht-Fotos sind immer anonym",
      "Ausbildungszweck erlaubt jede Detailtiefe"
    ],
    correctIndex: 1, feedback: "Anonymisierung/Pseudonymisierung sorgfältig gestalten.", si: 0.48, ti: 0.35
  }
];

/* ======= LOGIK ======= */
function shuffle(arr){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

function renderQuiz(items, showPsych=false){
  const container = document.getElementById("quiz");
  container.innerHTML = "";
  items.forEach((item, idx) => {
    const card = document.createElement("div");
    card.className = "card";

    const h3 = document.createElement("h3");
    h3.textContent = `Frage ${idx + 1}`;

    // SI/TI Pills (designer only)
    const pillSI = document.createElement("span");
    pillSI.className = "pill" + ((item.si<0.3 || item.si>0.85) ? " bad" : "");
    pillSI.textContent = `SI: ${item.si.toFixed(2)}`;

    const pillTI = document.createElement("span");
    pillTI.className = "pill" + ((item.ti<0.2) ? " bad" : "");
    pillTI.textContent = `TI: ${item.ti.toFixed(2)}`;

    if(showPsych){
      h3.appendChild(pillSI);
      h3.appendChild(pillTI);
    }
    card.appendChild(h3);

    const p = document.createElement("p");
    p.textContent = item.q;
    card.appendChild(p);

    const choiceOrder = shuffle(item.choices.map((c,i)=>({c,i})));
    const div = document.createElement("div");
    div.className = "choices";

    choiceOrder.forEach(({c,i})=>{
      const id = `q${idx}_opt${i}`;
      const label = document.createElement("label");
      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q${idx}`;
      input.value = i;
      input.id = id;
      label.setAttribute("for", id);
      label.appendChild(input);
      label.append(" " + c);
      div.appendChild(label);
    });

    card.appendChild(div);
    container.appendChild(card);
  });
}

function grade(items){
  let correct=0;
  const perQuestion=[];
  items.forEach((item, idx)=>{
    const selected = document.querySelector(`input[name="q${idx}"]:checked`);
    const selIndex = selected ? parseInt(selected.value,10) : null;
    const ok = selIndex === item.correctIndex;
    perQuestion.push({ ok, selIndex, correctIndex:item.correctIndex, feedback:item.feedback||"", si:item.si, ti:item.ti });
    if(ok) correct++;
  });
  const total = items.length;
  const percent = Math.round((correct/total)*100);
  const passed = percent >= PASS_THRESHOLD;
  return { correct, total, percent, passed, perQuestion };
}

/* ======= INIT ======= */
const randomizedItems = shuffle(ITEM_BANK.slice());
const meta = document.getElementById("meta");
meta.textContent = `${TEST_TITLE} · ${TEST_DESC} · Bestehensgrenze: ${PASS_THRESHOLD}%`;
renderQuiz(randomizedItems, false);

/* ======= EVENTS ======= */
document.getElementById("submitBtn").addEventListener("click", ()=>{
  const { correct, total, percent, passed, perQuestion } = grade(randomizedItems);
  const box = document.getElementById("summary");
  box.classList.remove("hidden","pass","fail");
  box.classList.add("result", passed ? "pass" : "fail");
  box.textContent = `${percent}% (${correct}/${total}) – ${passed ? "Bestanden ✅" : "Nicht bestanden ❌"}`;

  // Psychometrie-Auswertung (nur für Ersteller – nicht antwortspezifisch)
  const avgSI = perQuestion.reduce((s,q)=>s+q.si,0)/perQuestion.length;
  const avgTI = perQuestion.reduce((s,q)=>s+q.ti,0)/perQuestion.length;
  const stats = document.getElementById("psychStats");
  stats.textContent = `Mittelwerte (Items): SI ≈ ${avgSI.toFixed(2)}, TI ≈ ${avgTI.toFixed(2)}. ` +
                      `Empfehlung: SI 0.3–0.8, TI ≥ 0.20 (je nach Einsatz).`;
  stats.classList.remove("hidden");

  window.scrollTo({ top: document.body.scrollHeight, behavior:"smooth" });
});

document.getElementById("retryBtn").addEventListener("click", ()=>location.reload());

document.getElementById("togglePsych").addEventListener("change", (e)=>{
  const show = e.target.checked;
  renderQuiz(randomizedItems, show);
});
</script>
</body>
</html>
